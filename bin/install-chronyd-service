#!/bin/sh

# install-chronyd-service: Install and start container-chronyd podman service.

set -e

if [ "$(id -u)" != "0" ]; then
  echo "Must be root!"
  exit 1
fi

# Make sure the local service definition is available.
if [ ! -e container-chronyd.service ]; then
  echo "Error: File container-chronyd.service not found."
  exit 1
fi

# Stop and disable the local chronyd service in case it is running.
systemctl stop    chronyd >/dev/null 2>&1 || :
systemctl disable chronyd >/dev/null 2>&1 || :

# Copy the service to the systemd library and reload, if necessary.
if ! diff /usr/lib/systemd/system/container-chronyd.service container-chronyd.service >/dev/null 2>&1 ; then
  echo "Reloading container-chronyd service."
  cp -p container-chronyd.service /usr/lib/systemd/system/
  systemctl daemon-reload
fi

# Start/restart container-chronyd service.
systemctl restart container-chronyd.service

